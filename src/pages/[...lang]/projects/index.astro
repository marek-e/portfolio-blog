---
import Layout from '@/layouts/Layout.astro';
import Navbar from '@/components/astro/Navbar.astro';
import Footer from '@/components/astro/Footer.astro';
import ProjectListCard from '@/components/astro/ProjectListCard.astro';
import { getCollection } from 'astro:content';
import { getTranslations, defaultLang, languages } from '@/i18n';
import { sortProjects } from '@/lib/projects';

export function getStaticPaths() {
  return [{ params: { lang: undefined } }, { params: { lang: 'en' } as const }];
}

const lang = Astro.params.lang ?? defaultLang;
const t = getTranslations(lang);

const allProjects = await getCollection('projects');
const projects = sortProjects(allProjects.filter((project) => project.id.startsWith(`${lang}/`)));

const featuredProjects = projects.filter((p) => p.data.featured);
const regularProjects = projects.filter((p) => !p.data.featured);
---

<Layout title={t.projectsPage.pageTitle} description={t.projectsPage.pageDescription}>
  <script
    is:inline
    slot="head"
    type="application/ld+json"
    set:html={JSON.stringify({
      '@context': 'https://schema.org',
      '@type': 'CollectionPage',
      name: 'Projets - Marek Elmayan',
      url: 'https://melmayan.fr/projects',
      description: 'Portfolio de projets techniques et crÃ©atifs de Marek Elmayan.',
      author: {
        '@type': 'Person',
        name: 'Marek Elmayan',
      },
      inLanguage: Object.keys(languages),
    })}
  />
  <Navbar />
  <main class="container mx-auto min-h-dvh w-full max-w-6xl px-4 pt-32 pb-16">
    <header class="mb-12 space-y-4">
      <h1 class="text-4xl font-bold tracking-tight">{t.projectsPage.title}</h1>
      <p class="text-muted-foreground max-w-2xl text-lg">{t.projectsPage.subtitle}</p>
    </header>

    {
      projects.length === 0 ? (
        <p class="text-muted-foreground py-12 text-center">{t.projectsPage.noProjects}</p>
      ) : (
        <div class="space-y-12">
          {featuredProjects.length > 0 && (
            <section>
              <h2 class="text-primary mb-6 flex items-center gap-2 text-xl font-semibold">
                <span class="bg-primary inline-block size-2 rounded-full" />
                {t.projects.title}
              </h2>
              <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
                {featuredProjects.map((project) => (
                  <ProjectListCard project={project} featured />
                ))}
              </div>
            </section>
          )}

          {regularProjects.length > 0 && (
            <section>
              <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
                {regularProjects.map((project) => (
                  <ProjectListCard project={project} />
                ))}
              </div>
            </section>
          )}
        </div>
      )
    }
  </main>
  <Footer />
</Layout>
