---
import { getCollection } from 'astro:content';
import ProjectCard from './ProjectCard.astro';
import { getTranslations, getLangFromUrl, getTranslatedPath } from '@/i18n';

const lang = getLangFromUrl(Astro.url);
const t = getTranslations(lang);
const translatePath = getTranslatedPath(lang);

const allProjects = await getCollection('projects');
const featuredProjects = allProjects
  .filter((project) => project.id.startsWith(`${lang}/`))
  .filter((project) => project.data.featured)
  .sort((a, b) => b.data.publishDate.valueOf() - a.data.publishDate.valueOf())
  .slice(0, 5);
---

<section id="projects" class="relative py-20 md:py-32">
  <div class="mx-auto max-w-6xl px-4 sm:px-6 lg:px-8">
    <div class="mb-12 flex items-end justify-between">
      <div>
        <h2 class="text-foreground text-3xl font-bold tracking-tight md:text-4xl">
          {t.projects.title}
        </h2>
        <p class="text-muted-foreground mt-2">{t.projects.subtitle}</p>
      </div>
      <a
        href={translatePath('/projects')}
        class="text-primary hover:text-primary/80 hidden text-sm font-medium transition-colors md:block"
      >
        {t.projects.viewAll}
      </a>
    </div>

    {
      featuredProjects.length > 0 ? (
        <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
          {featuredProjects.map((project) => (
            <ProjectCard project={project} />
          ))}
        </div>
      ) : (
        <p class="text-muted-foreground">{t.projects.noProjects}</p>
      )
    }

    <div class="mt-8 text-center md:hidden">
      <a
        href={translatePath('/projects')}
        class="text-primary hover:text-primary/80 text-sm font-medium transition-colors"
      >
        {t.projects.viewAll}
      </a>
    </div>
  </div>
</section>
