---
import { Button, Link } from '@/components/ui/button';
import { HugeiconsIcon } from '@hugeicons/react';
import { Copy01Icon, Sent02Icon } from '@hugeicons/core-free-icons';
import { EMAIL, SOCIALS } from '@/lib/socials';
import { getTranslations, getLangFromUrl } from '@/i18n';

const lang = getLangFromUrl(Astro.url);
const t = getTranslations(lang);
---

<section id="contact" class="relative py-20 md:py-32">
  <div class="mx-auto max-w-6xl px-4 text-center sm:px-6 lg:px-8">
    <h2 class="text-foreground mb-4 text-3xl font-bold tracking-tight md:text-4xl">
      {t.contact.title}
    </h2>
    <p class="text-muted-foreground mx-auto mb-8 max-w-lg text-lg">
      {t.contact.subtitle}
    </p>

    <div class="mb-12 flex flex-col items-center justify-center gap-4 md:flex-row">
      <Link
        size="lg"
        className="w-1/2 gap-2 md:w-auto"
        href={`mailto:${EMAIL}`}
        animation="scale"
        aria-label={t.aria.sendEmail}
      >
        {t.contact.cta}
        <HugeiconsIcon icon={Sent02Icon} className="size-5" data-icon="inline-start" />
      </Link>
      <Button
        variant="ghost"
        size="lg"
        className="w-1/2 cursor-pointer md:w-auto"
        id="copy-email-btn"
        data-email={EMAIL}
        aria-label="Copy email"
      >
        {EMAIL}
        <HugeiconsIcon icon={Copy01Icon} className="ml-2 size-5" />
      </Button>
    </div>
    <p class="text-muted-foreground mx-auto mb-8 max-w-lg text-lg">
      {t.contact.socialIntro}
    </p>
    <div class="flex items-center justify-center gap-4">
      {
        SOCIALS.map((social) => (
          <a
            href={social.href}
            target="_blank"
            rel="noopener noreferrer"
            aria-label={t.aria.followOn.replace('{platform}', social.name)}
            class="text-muted-foreground hover:text-foreground hover:bg-muted rounded-full p-3 transition-colors"
          >
            <HugeiconsIcon icon={social.icon} className="size-6" />
          </a>
        ))
      }
    </div>
  </div>
</section>

<script>
  import { toast } from '@/lib/toast';
  import { getLangFromClient } from '@/i18n';

  function initCopyEmail() {
    const btn = document.getElementById('copy-email-btn');
    if (!btn) return;

    const email = btn.dataset.email;

    btn.addEventListener('click', async () => {
      const lang = getLangFromClient();
      try {
        await navigator.clipboard.writeText(email || '');
        toast.success(lang === 'en' ? 'Email copied!' : 'Email copié !');
      } catch {
        toast.error(lang === 'en' ? 'Failed to copy' : 'Échec de la copie');
      }
    });
  }

  initCopyEmail();
  document.addEventListener('astro:after-swap', initCopyEmail);
</script>
