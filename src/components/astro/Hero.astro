---
import { Link } from '@/components/ui/button';
---

<section class="relative flex min-h-screen items-center justify-center overflow-hidden">
  <!-- Preload appropriate image based on theme -->
  <link
    rel="preload"
    as="image"
    href="/bg-light.webp"
    media="(prefers-color-scheme: light)"
    fetchpriority="high"
  />
  <link
    rel="preload"
    as="image"
    href="/bg-dark.webp"
    media="(prefers-color-scheme: dark)"
    fetchpriority="high"
  />

  <!-- Background Images with responsive srcset -->
  <picture class="absolute inset-0 -z-10 dark:hidden">
    <img
      src="/bg-light.webp"
      srcset="/bg-light.webp 1920w"
      sizes="100vw"
      alt="Wide valley at sunrise with green hills, wildflowers in the foreground, and tall rocky cliffs on both sides, softly lit by warm sunlight and light mist."
      class="h-full w-full object-cover"
      fetchpriority="high"
      decoding="async"
      loading="eager"
    />
  </picture>
  <picture class="absolute inset-0 -z-10 hidden dark:block">
    <img
      src="/bg-dark.webp"
      srcset="/bg-dark.webp 1920w"
      sizes="100vw"
      alt="Moonlit valley at night with rolling hills, mist over the grass, wildflowers in the foreground, tall cliffs on both sides, and a bright full moon in a starry sky."
      class="h-full w-full object-cover"
      fetchpriority="high"
      decoding="async"
      loading="eager"
    />
  </picture>

  <!-- Low-quality placeholder overlay (fades out when image loads) -->
  <div
    class="from-primary/20 via-secondary/10 to-primary/20 dark:from-primary/30 dark:via-secondary/20 dark:to-primary/30 absolute inset-0 -z-10 bg-linear-to-br opacity-100 transition-opacity duration-1000"
    id="bg-placeholder"
  >
  </div>

  <!-- Content -->
  <div class="relative z-10 mx-auto max-w-4xl px-4 text-center sm:px-6 lg:px-8">
    <!-- Announcement Badge -->
    <span
      class="text-foreground mb-6 inline-flex items-center gap-1 rounded-full border border-white/20 bg-white/80 px-3 py-1 text-xs font-medium backdrop-blur-sm dark:border-white/10 dark:bg-black/50 dark:text-white"
    >
      Available for freelance work
    </span>

    <!-- Headline -->
    <h1
      class="text-foreground mb-6 text-5xl font-bold drop-shadow-lg sm:text-6xl lg:text-7xl dark:text-white"
    >
      Hi, I'm a Developer
    </h1>

    <!-- Subtitle -->
    <p
      class="text-foreground/90 mx-auto mb-8 max-w-2xl text-lg drop-shadow-md sm:text-xl lg:text-2xl dark:text-white/90"
    >
      I build things for the web with modern tools.<br />
      Clean code, great user experiences.
    </p>

    <!-- CTAs -->
    <div class="flex flex-col items-center justify-center gap-4 sm:flex-row">
      <Link
        size="lg"
        href="#projects"
        className="text-foreground rounded-full bg-white px-8 py-6 text-base font-medium shadow-lg hover:bg-white/90 dark:bg-white dark:text-black dark:hover:bg-white/90"
      >
        View Projects
      </Link>
      <Link
        variant="ghost"
        size="lg"
        href="#contact"
        className="text-foreground rounded-full border border-white/20 bg-white/10 px-8 py-6 text-base font-medium backdrop-blur-sm hover:bg-white/20 dark:border-white/10 dark:bg-black/30 dark:text-white dark:hover:bg-black/50"
      >
        Get in Touch
      </Link>
    </div>
  </div>
</section>

<style>
  @media (prefers-reduced-motion: reduce) {
    * {
      transition: none !important;
      animation: none !important;
    }
  }

  /* Optimize image rendering */
  picture img {
    image-rendering: -webkit-optimize-contrast;
    image-rendering: crisp-edges;
  }

  /* Images start visible by default (for cached/fast loads) */
  picture img {
    opacity: 1;
  }

  /* Only apply fade-in when explicitly marked as loading */
  picture img.is-loading {
    opacity: 0;
    transition: opacity 0.5s ease-in-out;
  }

  picture img.is-loading.loaded {
    opacity: 1;
  }
</style>

<script>
  // Run immediately (not on DOMContentLoaded) to avoid flash
  (() => {
    const placeholder = document.getElementById('bg-placeholder');
    const images = document.querySelectorAll<HTMLImageElement>('picture img');

    let loadedCount = 0;
    const totalImages = images.length;

    const hidePlaceholder = () => {
      if (placeholder) {
        placeholder.style.opacity = '0';
        setTimeout(() => {
          placeholder.style.display = 'none';
        }, 1000);
      }
    };

    images.forEach((img) => {
      // If already loaded (cached), don't animate - just count it
      if (img.complete && img.naturalHeight > 0) {
        loadedCount++;
      } else {
        // Not loaded yet - add loading class for fade effect
        img.classList.add('is-loading');
        img.addEventListener('load', () => {
          img.classList.add('loaded');
          loadedCount++;
          if (loadedCount === totalImages) {
            hidePlaceholder();
          }
        });
        img.addEventListener('error', () => {
          console.warn('Background image failed to load');
        });
      }
    });

    // If all images are already loaded (cached), hide placeholder immediately
    if (loadedCount === totalImages) {
      if (placeholder) {
        placeholder.style.opacity = '0';
        placeholder.style.display = 'none';
      }
    }
  })();
</script>
