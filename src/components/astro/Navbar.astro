---
import { ModeToggle } from '@/components/react/ModeToggle';
import { MobileMenu } from '@/components/react/MobileMenu';
import { LanguageSwitcher } from '@/components/react/LanguageSwitcher';
import { Star } from '@hugeicons/core-free-icons';
import { Icon } from '@/components/react/Icon';
import { getNavLinks } from '@/lib/navigation';
import { getLangFromUrl, getTranslatedPath } from '@/i18n';

const lang = getLangFromUrl(Astro.url);
const translatePath = getTranslatedPath(lang);
const navLinks = getNavLinks(lang);
const currentPath = Astro.url.pathname;

const linksClasses =
  'text-foreground/80 hover:text-foreground flex items-center gap-2 relative z-10 rounded-lg px-3 py-1.5 text-sm transition-colors';
---

<nav class="fixed top-6 left-1/2 z-50 w-fit -translate-x-1/2">
  <div
    class="relative flex items-center gap-6 rounded-full border border-white/40 bg-white/10 px-6 py-3 shadow-xl shadow-black/5 backdrop-blur-lg before:pointer-events-none before:absolute before:inset-0 before:rounded-full before:bg-linear-to-b before:from-white/30 before:via-transparent before:to-transparent dark:border-white/20 dark:bg-black/10 dark:shadow-black/40 dark:before:from-white/10"
  >
    <a
      href={translatePath('/')}
      class="text-foreground group/logo flex items-center gap-2 font-semibold transition-all duration-300 ease-in-out hover:-rotate-3 hover:opacity-80 motion-reduce:hover:rotate-0"
    >
      <Icon
        icon={Star}
        strokeWidth={2}
        fill="currentColor"
        className="text-primary size-4 transition-transform duration-300 ease-in-out group-hover/logo:rotate-360 motion-reduce:group-hover/logo:animate-none"
      />
      <span class="inline-block">melmayan</span>
    </a>

    <div id="nav-links" class="relative hidden items-center gap-1 md:flex">
      <div
        id="nav-pill"
        class="bg-primary/20 shadow-primary/30 pointer-events-none absolute rounded-lg opacity-0 shadow-sm transition-all duration-200 ease-out"
      >
      </div>
      {
        navLinks.map((link) => (
          <a href={link.href} class={linksClasses} data-nav-link>
            <Icon icon={link.icon} strokeWidth={2} className="size-4" />
            {link.label}
          </a>
        ))
      }
    </div>

    <div class="flex items-center gap-2">
      <MobileMenu client:load />
      <LanguageSwitcher client:load currentLang={lang} currentPath={currentPath} />
      <ModeToggle client:load />
    </div>
  </div>
</nav>

<script>
  function initNavPillEffect() {
    const container = document.getElementById('nav-links');
    const pill = document.getElementById('nav-pill');
    const links = document.querySelectorAll('[data-nav-link]');

    if (container && pill) {
      const updatePill = (el: HTMLElement) => {
        const containerRect = container.getBoundingClientRect();
        const linkRect = el.getBoundingClientRect();

        pill.style.width = `${linkRect.width}px`;
        pill.style.height = `${linkRect.height}px`;
        pill.style.left = `${linkRect.left - containerRect.left}px`;
        pill.style.top = `${linkRect.top - containerRect.top}px`;
        pill.style.opacity = '1';
      };

      const hidePill = () => {
        pill.style.opacity = '0';
      };

      links.forEach((link) => {
        link.addEventListener('mouseenter', () => updatePill(link as HTMLElement));
      });

      container.addEventListener('mouseleave', hidePill);
    }
  }

  // Initialize on page load
  initNavPillEffect();

  // Re-initialize after View Transitions navigation
  document.addEventListener('astro:after-swap', initNavPillEffect);
</script>
